<!DOCTYPE html>
<html lang="en">
<head>
  <title>Hello, world!</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pixelated" type="text/css"/>
  <meta name="description" content="" />
  <style>
    document, body {
      padding: 0px;
      margin: 0px;
    }
  </style>
</head>
<body>
  <canvas id="canvas">
  <script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

(window.onresize = () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ctx.imageSmoothingEnabled = false;
})();

const mouse = { x: 0, y: 0 };
window.onmousemove = ev => (mouse.x = ev.pageX, mouse.y = ev.pageY);

const easeInOutQuint = x => (x < 0.5)
  ? (16 * x * x * x * x * x)
  : (1 - Math.pow(-2 * x + 2, 5) / 2);

const easeOutBounce = x => {
  const n1 = 7.5625;
  const d1 = 2.75;

  if (x < 1 / d1) {
      return n1 * x * x;
  } else if (x < 2 / d1) {
      return n1 * (x -= 1.5 / d1) * x + 0.75;
  } else if (x < 2.5 / d1) {
      return n1 * (x -= 2.25 / d1) * x + 0.9375;
  } else {
      return n1 * (x -= 2.625 / d1) * x + 0.984375;
  }
}
const easeInOutBounce = x => (x < 0.5)
  ? (1 - easeOutBounce(1 - 2 * x)) / 2
  : (1 + easeOutBounce(2 * x - 1)) / 2;

(async () => {
  const art = Object.fromEntries(await Promise.all(
    ["wing", "ocean", "pillars", "windows"]
      .map(name => new Promise(res => {
        const asset = new Image();
        asset.onload = () => res([name, asset]);
        asset.src = name + ".png";
      }))
  ));

  (function frame() {

    (() => {
      ctx.save();

      const { width, height } = art.ocean;
      ctx.scale(window.innerWidth  /  width,
                window.innerHeight / height);

      const pan = (img, speed) => {
        const w = img.width;
        ctx.drawImage(img, (Date.now() / speed) % w, 0);
        ctx.drawImage(img, (Date.now() / speed) % w - w*Math.sign(speed), 0);
      };

      pan(art.ocean, 300);
      pan(art.windows, 200);
      pan(art.pillars, 100);

      ctx.restore();
    })();

    const cloud = (() => {
      const circles = [];
      for (let i = 0; i < 31; i++) {
        let t = (0.5 - i/30);

        const q = Math.sin(t * 400 + Date.now() / 1000)/2;
        const r = q * (0.5 - Math.abs(t));
        const x =     140 - t * 350,
              y = r * 140          ;

        circles.push({
          x,
          y,
          radius: 65 * (1 - Math.abs(t)),
          brightness: (0.6 + 0.4 * (1-r)) * 255,
        });
      }

      const offscreen = document.createElement("canvas");
      const scale = 0.1;
      const w = 450 * 0.8, h = 250 * 0.8;
      offscreen.width = w * scale;
      offscreen.height = h * scale;
      const octx = offscreen.getContext("2d");

      octx.scale(scale * 0.8, scale * 0.8);
      octx.translate(80, 120);

      const circle = (x, y, radius) => {
        octx.beginPath();
        octx.arc(x, y, radius, 0, Math.PI*2);
        octx.fill();
      }

      const setFill = b => octx.fillStyle = `rgb(${b}, ${b-20}, ${b})`;
      for (let i = 0; i < 5; i++)
        for (const { x, y, radius, brightness: b } of circles)
          setFill(b * 0.6), circle(x, y, radius*1.1);

        for (const { x, y, radius, brightness: b } of circles)
          setFill(b), circle(x, y, radius);

      return () => ctx.drawImage(offscreen, 5-w/2, -h/2, w, h);
    })();


    (() => {
      const wing = (x, y, dir) => {
        ctx.save();
        ctx.translate(x, y);
        ctx.scale(3 * dir, 3);
        ctx.rotate(Math.sin(Date.now() / 200) * (2/8) * Math.PI)
        const { width, height } = art.wing;
        ctx.drawImage(art.wing, -width*0.8, -height*0.8);
        ctx.restore();
      };

      const button = (text, highlight, ay) => {
        ctx.save();
        const w = 350;
        const t = Math.sin(ay + Date.now() / 400);
        const x = 150 + w/2, y = ay + 10 * t;
        const hover = Math.abs(mouse.x - x) < w/2 &&
                      Math.abs(mouse.y - y) < 40;
        ctx.translate(x, y);
        ctx.rotate(t * (2/70) * Math.PI);
        ctx.font = '50px "SFPixelateShadedRegular"';
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        cloud(x, y);

        ctx.fillStyle = hover ? "crimson" : highlight;
        ctx.fillText(text, 0, 0, w * 0.85);

        wing(w/-2, 0,  1);
        wing(w/ 2, 0, -1);
        ctx.restore();
      };
      const space = 215;
      button("NEW PROJECT", "maroon", space*1);
      button("CHALLENGES", "purple", space*2);
      button("REFERENCE", "darkblue", space*3);
    })();

    requestAnimationFrame(frame);
  })();
})();

  </script>
</body>
</html>
